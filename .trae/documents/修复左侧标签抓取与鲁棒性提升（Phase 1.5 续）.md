## 结果评估
- 详情页 Banner 注入与正文提取已成功；Console 已打印正文预览。
- 左侧标签抓取返回空数组，Banner 显示“未检测到左侧标签”。
- 你看到的大量 service worker/Chat 相关网络错误与我们扩展无关；它们不会阻止内容脚本读 DOM。

## 可能原因
- 左侧导航使用虚拟化/延迟渲染，未滚动/未展开时标签节点未插入 DOM。
- 标签链接 `href` 采用百分编码（如 `%23label%2F`、`label%3A`）或结构非 `<a>`，当前选择器未命中。
- 标签折叠在“更多/隐藏部分标签”按钮下，未展开时不可见。

## 实施方案
### 1) 升级抓取选择器与解析
- 在 `getUserLabels()` 中增加多策略选择器：
  - `a[href*="#label/"]`, `a[href*="%23label%2F"]`, `a[href*="label%3A"]`, `div[role="treeitem"] a[href]`
- 优先从 `href` 正则解析并 `decodeURIComponent` 获取标签名；失败再回退 `aria-label/title/textContent`。
- 仅保留 `href` 中包含 `label` 的节点；去重与清洗计数后缀（如 `(12)`）。

### 2) 导航就绪与展开
- 新增“导航就绪”探测：监控左侧容器节点数量稳定（如 2 次采样间差值为 0）再抓取。
- 自动尝试展开折叠区：查找文本包含“更多”、“隐藏部分标签”、“More”的按钮/链接，执行一次点击；随后 300–500ms 再抓取。

### 3) 虚拟化兼容与滚动触发
- 对左侧导航区域执行小幅度滚动（上下 200px）以触发虚拟列表渲染，再抓取。
- 使用 `MutationObserver` 监听导航区域新增节点，批量去抖后重试抓取。

### 4) 安全回退（可选）
- 回退方案：短暂打开 Gmail 工具栏的“标签”选择面板，读取面板内的标签项文本，再立即关闭。
- 仅读取，不选择；作为“界面真实存在的标签”的来源，避免硬编码。

### 5) 调试与验证
- 增加日志：抓取到的节点计数、解析来源（href/aria/text）、最终标签数组；打印是否经过“展开/滚动”回退。
- 验证步骤：
  - 展开左侧“更多/隐藏部分标签”，滚动一次侧边栏
  - 观察 Console：`[Gmail Copilot] Scraped Labels: [...]` 不为空；Banner 显示随机真实标签

### 6) 非目标
- 不改动正文提取与 Banner 交互；不接入 AI（保留 TODO 标注）。

## 交付物
- 更新 `content.js`：重构 `getUserLabels()`，新增导航就绪/展开/滚动与回退逻辑；保留现有注入流程与日志。
- 不改其他文件。

## 请确认
- 是否允许使用“安全回退”策略（短暂打开并读取“标签”面板后立刻关闭）？
- 若确认，我将按上述方案更新代码并提交修改。